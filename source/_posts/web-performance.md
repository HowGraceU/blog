---
title: 前端性能优化
date: 2019-05-04
tags:
    - web
    - performance
---

## 一、文件加载

### 雅虎军规

**[雅虎军规](https://www.cnblogs.com/xianyulaodi/p/5755079.html#_label7),一个老牌的前端优化指南，其中有好些点现在也还在延用，这里只枚举其中几点。**

**1.    合并压缩资源成一个文件。将一个页面中的css和js文件分别合并以及使用雪碧图，尽量江绍http请求。**

**2.    使用 CDN。浏览器对相同域名的请求有并发数限制，使用 CND 可以让浏览器从不同的域名发请求，可并发数增加。其次，向 CDN 请求静态资源时，请求头不会带上只有主域名才需要的 cookie 浪费带宽。但是 CDN 设置过多的话，会浪费 DNS 的时间，CDN 的数量一般为 2-4 个。**

**3.    设置缓存和 Gzip。对长时间不修改的库、静态资源乃至 ajax，都可以设置 Expires 或者Cache-Control HTTP 头，[点击查看更多缓存相关细节](#1)。设置 Gzip 能有效压缩文本文件。**

**4.    样式表放上面，脚本放下面。css 中存在页面渲染所需要的内容，为了让页面尽快渲染完成，不要将 css 放在页面的底部。js 脚本的下载会阻塞页面的渲染，因为浏览器不知道 js 中是否会操作 dom 元素，其次，浏览器在下载 js 的时候，不会并行其他资源的下载。**

**5.    减少 Dom 的数量、事件、和对 Dom 的访问。一个页面的 Dom 数不能过多，淘宝首页的 Dom 数为 1341。一个区域的绑定的事件过多，使用事件代理来处理这些事件。对访问过的 Dom 进行缓存，下次使用时就不需要再次获取。**

### 离线缓存

**将一些长时间不修改的静态资源文件缓存在 localStorage 中，可以有效减少请求，加快页面渲染。一个域的 localStorage 只有 5M。**

### http 的升级

**http 1.1 中引入了 Connection：keep-alive 长连接，使得不必每次请求都进行 tcp 握手，很大程度上改善了网页的性能，但是也还有很多不足之处。比如请求都是串行的，若其中一个请求返回慢容易造成 http 消息头堵塞。**

**http 2.0 中增加了部分强大的新特性。**

**1.    协议传输采用二进制。**

**2.    协议头进行压缩，且重复的 headers 可以进行缓存。**

**3.    多路复用。一个连接同一时刻可以被多个流使用。这意味着连接可以同时传输多个请求的数据，所有的请求的应答可以并行。**

**4.    全双工通讯。服务端可以主动推送消息。**